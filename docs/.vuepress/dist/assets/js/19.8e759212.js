(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{452:function(t,s,a){"use strict";a.r(s);var n=a(2),o=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p",[t._v("环境:")]),t._v(" "),t._m(0),t._v(" "),a("p",[t._v("目前已经资瓷Https,Http2.0,TLS1.3,HSTS,控制一定时间内请求数等功能")]),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("HTTPS本质上是一个公钥和私钥的配对过程，其通过SSL/TLS协议实现，通常只对服务器端进行效验")]),t._v(" "),a("p",[t._v("HTTPS配置就是配置证书")]),t._v(" "),a("p",[t._v("配置HTTPS主要是从使用Service Work角度出发的，Service Work必须配置HTTPS才能work")]),t._v(" "),a("p",[t._v("Https的配置主要难点就是SSL证书的生成+多域名证书的生成")]),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("OpenSSL提供的是自签名证书， 自签名访问时会出现不安全字样")]),t._v(" "),t._m(3),t._m(4),t._v(" "),a("p",[t._v("Certbot提供的是权威签名证书")]),t._v(" "),t._m(5),a("p",[t._v("另外参考"),a("a",{attrs:{href:"https://aotu.io/notes/2016/08/16/nginx-https/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("凹凸实验室的博客"),a("OutboundLink")],1),t._v("对HTTPS还进行了优化")]),t._v(" "),a("p",[t._v("另外Mozilla专门做了一个"),a("a",{attrs:{href:"https://mozilla.github.io/server-side-tls/ssl-config-generator/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ssl配置生成器"),a("OutboundLink")],1)]),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[t._v("HSTS = HTTP Strict Transport Security,即强制使用HTTPS进行连接")]),t._v(" "),a("p",[t._v("试图解决HTTP请求被劫持的情况，虽然其真实效果有待商榷")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),a("p",[t._v("对这种情況，Google 维护了一份『HSTS 预加载列表』，列表里包含了使用了"),a("code",[t._v("HSTS")]),t._v("的站点主域名和子域名，"),a("a",{attrs:{href:"https://hstspreload.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("可以通过该链接申请加入"),a("OutboundLink")],1)]),t._v(" "),t._m(14),t._v(" "),a("p",[t._v("HTTP2是万维网目前最新的网络传输协议，相对于HTTP/1.1优化了传输效率")]),t._v(" "),a("p",[t._v("HTTP2的配置比较简单，主要是Nginx升至1.9.3以上，OpenSSL升至1.0.2以上")]),t._v(" "),a("p",[t._v("HTTP2虽然不强制使用HTTPS，但普遍都建立在TLS之上，所以还是需要HTTPS的配置的")]),t._v(" "),t._m(15),t._m(16),t._v(" "),a("p",[t._v("TLS1.3在2018年8月的RFC 8446会议中正式定稿，其相较于TLS1.2有很大改动")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("利用高版本curl,验证TLS1.3配置成功")]),t._v(" "),t._m(19),t._m(20),t._v(" "),a("p",[t._v("爬虫对网站浏览量的统计有较大的影响")]),t._v(" "),a("p",[t._v("为保护网站安全，对爬虫及访问次数进行了限制")]),t._v(" "),t._m(21),t._m(22),t._v(" "),a("p",[t._v("虽然已经有了Server Work，但Nginx最牛的静态资源优化方案-缓存还是要配一下的")]),t._v(" "),t._m(23),a("p",[t._v("PS： 因为使用了Server Work，利用文件的Hash值做版本管理，缓存管理的html文件对这一系统造成了较大的麻烦，故取消配置")]),t._v(" "),t._m(24),t._v(" "),a("p",[t._v("... Because of qiong, There is only one Server machine.")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),a("p",[t._v(". "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000011224813",target:"_blank",rel:"noopener noreferrer"}},[t._v("让你的网站秒配 HTTPS 证书"),a("OutboundLink")],1),a("br"),t._v("\n. "),a("a",{attrs:{href:"https://aotu.io/notes/2016/08/16/nginx-https/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx 配置 HTTPS 服务器"),a("OutboundLink")],1),a("br"),t._v("\n. "),a("a",{attrs:{href:"https://www.jianshu.com/p/aa3f7c4d3a10",target:"_blank",rel:"noopener noreferrer"}},[t._v("让Nginx快速支持TLS1.3协议"),a("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Ubuntu18.04.1 LTS - aliYun"),s("br"),this._v("\nnginx/1.15.3"),s("br"),this._v("\nopenssl 1.1.1")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https","aria-hidden":"true"}},[this._v("#")]),this._v(" HTTPS")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"openssl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openssl","aria-hidden":"true"}},[this._v("#")]),this._v(" OpenSSL")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("## 生成私钥\nopenssl genrsa "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("out server"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2048")]),t._v("\n## 修改openssl"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cnf")]),t._v("文件\n"),a("span",{attrs:{class:"token keyword"}},[t._v("cp")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("openssl"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cnf")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n"),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" 取消"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" req "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 模块下注释：req_extensions "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" v3_req\n"),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" 确保"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" req_distinguished_name "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("下没有 "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xxx 的标签，有的话把"),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xxx的"),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" 去掉\n"),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" 在 "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" v3_req "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 块下增加一行 subjectAltName "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" @SubjectAlternativeName\n"),a("span",{attrs:{class:"token number"}},[t._v("4")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" 在文件末尾增加所有域名信息：\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SubjectAlternativeName"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDNS"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin\nDNS"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cn")]),t._v("\nDNS"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v("\n\n## 配置证书文件\nopenssl req "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" server"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("out server"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("csr "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("config "),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("openssl"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cnf")]),t._v("\n## openssl req "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("newkey rsa"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("2048")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("sha256 "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("nodes "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("out wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("csr "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("keyout wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("subj "),a("span",{attrs:{class:"token string"}},[t._v('"/C=CN/ST=ZheJiang/L=HangZhou/O=wyydsb/OU=wyydsb/CN=wyydsb.xin"')]),t._v("\n\n    Country Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" letter code"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AU"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("CN\n    State or Province Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("full name"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Some"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("State"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ZheJiang\n    Locality Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HangZhou\n    Organization Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" company"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Internet Widgits Pty Ltd"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("wyydsb\n    Organizational Unit Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" section"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("wyydsb\n    Common Name "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("e")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("g"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v(" server FQDN or YOUR name"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin # your server site\n    Email Address "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("yue"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("li3@21vianet"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v("\n\n    Please enter the following "),a("span",{attrs:{class:"token string"}},[t._v("'extra'")]),t._v(" attributes\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("be")]),t._v(" sent with your certificate request\n    A challenge password "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    An optional company name "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("wyydsb\n\n## 生成自签名证书"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("crt\nopenssl req "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("x509 "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("days "),a("span",{attrs:{class:"token number"}},[t._v("3650")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("keyout server"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("out server"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("crt "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("config openssl"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cnf")]),t._v("\n## 拷贝"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("crt"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v("地址于nginx"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),t._v("内\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"certbot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot","aria-hidden":"true"}},[this._v("#")]),this._v(" Certbot")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("sudo apt"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("get "),a("span",{attrs:{class:"token keyword"}},[t._v("update")]),t._v("\nsudo apt"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("get install software"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("properties"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("common\nsudo add"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("apt"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("repository ppa"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("certbot"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("certbot\nsudo apt"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("get "),a("span",{attrs:{class:"token keyword"}},[t._v("update")]),t._v("\nsudo apt"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("get install "),a("span",{attrs:{class:"token keyword"}},[t._v("python")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("certbot"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("nginx\n\n# 多域名证书生成\ncertbot certonly "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("standalone "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("email your@email"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("d")]),t._v(" yourdomain"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("d")]),t._v(" yourdomain2"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("d")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("yourdomain"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("d")]),t._v(" xxx\n# 记录命令执行后显示的"),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),t._v(" address\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("vim")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),t._v("\n\n# 修改为\nserver"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ssl_certificate   "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("letsencrypt"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("live"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("yourdomain"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("fullchain"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key  "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("letsencrypt"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("live"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("yourdomain"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("privkey"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_session_timeout 5m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_ciphers ECDHE"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("RSA"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("AES128"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("GCM"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("SHA256"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDHE"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDH"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("AES"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HIGH"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("NULL"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("ADH"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_protocols TLSv1 TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_prefer_server_ciphers "),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n# reload nginx\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("# 生成dhparam"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem文件\n"),a("span",{attrs:{class:"token keyword"}},[t._v("cd")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("certs\nopenssl dhparam "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("out dhparam"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem "),a("span",{attrs:{class:"token number"}},[t._v("2048")]),t._v("\n\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("vim")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),t._v("\n\n# 修改为\nserver"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),t._v(" http2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("\n\n    #优先采取服务器算法\n    ssl_prefer_server_ciphers "),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    #使用DH文件\n    ssl_dhparam "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("certs"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("dhparam"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_protocols TLSv1 TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    #定义算法\n    ssl_ciphers "),a("span",{attrs:{class:"token string"}},[t._v('"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    #减少点击劫持\n    add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Frame"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Options DENY"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    #禁止服务器自动解析资源类型\n    add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Options nosniff"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    #防XSS攻击\n    add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Xss"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Protection "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"hsts、『hsts-预加载列表』"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hsts、『hsts-预加载列表』","aria-hidden":"true"}},[this._v("#")]),this._v(" HSTS、『HSTS 预加载列表』")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"hsts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hsts","aria-hidden":"true"}},[this._v("#")]),this._v(" HSTS")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("当客户端通过HTTP发出请求时，rewrite至443")]),t._v(" "),a("li",[t._v("当客户端通过HTTPS发出请求时，服务器会发送一个带有"),a("code",[t._v("Strict-Transport-Security")]),t._v("的"),a("code",[t._v("Response Header")]),t._v("头，浏览器在获取该响应头后，在"),a("code",[t._v("max-age")]),t._v("的时间内，如果遇到"),a("code",[t._v("HTTP")]),t._v("连接，就会通过 307跳转強制使用 HTTPS 进行连接，并忽略其它的跳转设置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("vim")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),t._v("\n\n# 修改为\n## "),a("span",{attrs:{class:"token number"}},[t._v("80")]),t._v("端口拦截重定向\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rewrite ^"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" permanent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n## https header头增加Strict"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Transport"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Security\nserver"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),t._v(" http2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("\n\n    add_header Strict"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Transport"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Security "),a("span",{attrs:{class:"token string"}},[t._v('"max-age=31536000; includeSubDomains;preload"')]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"『hsts-预加载列表』"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#『hsts-预加载列表』","aria-hidden":"true"}},[this._v("#")]),this._v(" 『HSTS 预加载列表』")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于 HSTS 需要用戶经过一次安全的 HTTPS 连接后才会在"),s("code",[this._v("max-age")]),this._v("的时间內生效，因此 HSTS 策略并不能完美防止 HTTP 会话劫持，在下面这些情況下还是存在被劫持的可能：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("从未访问过的网站")]),t._v(" "),a("li",[t._v("近期重裝过操作系統")]),t._v(" "),a("li",[t._v("期重裝过浏览器")]),t._v(" "),a("li",[t._v("用新的浏览器")]),t._v(" "),a("li",[t._v("用了新的设备（如手机）")]),t._v(" "),a("li",[t._v("除了浏览器缓存")]),t._v(" "),a("li",[t._v("期沒有打开过网站且"),a("code",[t._v("max-age")]),t._v("过期")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http2","aria-hidden":"true"}},[this._v("#")]),this._v(" HTTP2")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("vim")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("conf")]),t._v("\n\n# 修改为\nserver"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),t._v(" http2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"tls1-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tls1-3","aria-hidden":"true"}},[this._v("#")]),this._v(" TLS1.3")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("将密钥协议和身份验证算法与密码套件分开")]),t._v(" "),a("li",[t._v("删除对弱和较少使用的命名椭圆曲线的支持")]),t._v(" "),a("li",[t._v("删除对MD5和SHA-224 加密哈希函数的支持")]),t._v(" "),a("li",[t._v("即使使用先前的配置，也需要数字签名")]),t._v(" "),a("li",[t._v("整合HKDF和半短暂的DH提案")]),t._v(" "),a("li",[t._v("用PSK和门票取代恢复")]),t._v(" "),a("li",[t._v("支持1-RTT握手和对0-RTT的初始支持")]),t._v(" "),a("li",[t._v("通过在（EC）DH密钥协议期间使用短暂密钥来强制完美的前向保密")]),t._v(" "),a("li",[t._v("删除对许多不安全或过时功能的支持，包括压缩，重新协商，非AEAD密码，非PFS密钥交换（其中包括静态RSA和静态DH密钥交换），自定义DHE组，EC点格式协商，更改密码规范协议，Hello消息UNIX时间，以及输入到AEAD密码的长度字段AD")]),t._v(" "),a("li",[t._v("禁止SSL或RC4协商以实现向后兼容性")]),t._v(" "),a("li",[t._v("集成使用会话哈希")]),t._v(" "),a("li",[t._v("弃用记录层版本号并冻结该数字以提高向后兼容性")]),t._v(" "),a("li",[t._v("将一些与安全相关的算法详细信息从附录移至规范，并将ClientKeyShare降级为附录")]),t._v(" "),a("li",[t._v("使用Poly1305消息验证代码添加ChaCha20流密码")]),t._v(" "),a("li",[t._v("添加Ed25519和Ed448数字签名算法")]),t._v(" "),a("li",[t._v("添加x25519和x448密钥交换协议")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("安装Nginx时 ./configure --with-openssl-opt=enable-tls1_3")]),t._v(" "),a("li",[t._v("openSSL 升至1.1.1")]),t._v(" "),a("li",[t._v("ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;")]),t._v(" "),a("li",[t._v("ssl_ciphers TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256;")]),t._v(" "),a("li",[t._v("浏览器打开TLS1.3支持chrome://flags/")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("$ curl "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("vvv https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" Rebuilt URL "),a("span",{attrs:{class:"token keyword"}},[t._v("to")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v("   Trying "),a("span",{attrs:{class:"token number"}},[t._v("47.75")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("137.198")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TCP_NODELAY "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" Connected "),a("span",{attrs:{class:"token keyword"}},[t._v("to")]),t._v(" wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("47.75")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("137.198")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#"),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" ALPN"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offering http"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" successfully "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" certificate verify locations"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v("   CAfile"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("certs"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("ca")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("certificates"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("crt\n  CApath"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Client hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Server hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS "),a("span",{attrs:{class:"token keyword"}},[t._v("change")]),t._v(" cipher"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Client hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Client hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Server hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no content"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Encrypted Extensions "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("8")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no content"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Certificate "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("11")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no content"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CERT verify "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("15")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no content"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Finished "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("20")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no content"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TLS handshake"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Finished "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("20")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" SSL connection using TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" TLS_AES_256_GCM_SHA384\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"反爬虫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反爬虫","aria-hidden":"true"}},[this._v("#")]),this._v(" 反爬虫")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("http"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          proxy_cache_path "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("proxy_cache levels"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" keys_zone"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("content"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("20m inactive"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("1d max_size"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("100m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$http_user_agent ~"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Scrapy|Curl|HttpClient"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$http_user_agent ~"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"ython|Hakai|Gemini|Shinka|LMAO|Ronin|Go-http-client|WinHttp|WebZIP|Postman|FetchURL|node-superagent|java/|FeedDemon|Jullo|JikeSpider|Indy Library|Alexa Toolbar|AskTbFXTV|AhrefsBot|CrawlDaddy|Java|Feedly|Apache-HttpAsyncClient|UniversalFeedParser|ApacheBench|Microsoft URL Control|Swiftbot|ZmEu|oBot|jaunty|Python-urllib|lightDeckReports Bot|YYSpider|DigExt|HttpClient|MJ12bot|heritrix|EasouSpider|Ezooms|BOT/0.1|YandexBot|FlightDeckReports|Linguee Bot|^$"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request "),a("span",{attrs:{class:"token operator"}},[t._v("!~")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"^GET"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request_method "),a("span",{attrs:{class:"token operator"}},[t._v("!~")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"^GET$"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request_uri ~"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"login|php|wp|^$"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request_uri "),a("span",{attrs:{class:"token operator"}},[t._v("!~")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"\\/(service-worker.js|robots.txt|assets.*|javascript\\/[a-zA-Z0-9]{2,20}.html.*|other\\/[a-zA-Z0-9]{2,20}.html.*|pat\\/[a-zA-Z0-9]{2,20}.html.*|)$"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 缓存")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("server"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         proxy_cache content"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_cache_valid  "),a("span",{attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("304")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("301")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("302")]),t._v(" 99s"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_cache_valid any 1s"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_redirect off"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_set_header Host $host"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_set_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("IP $remote_addr"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_set_header REMOTE"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("HOST $remote_addr"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_set_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("For $proxy_add_x_forwarded_for"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_set_header Connection "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_http_version "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_next_upstream off"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_ignore_client_abort "),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_ignore_headers Set"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Cookie Cache"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         client_max_body_size 30m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         client_body_buffer_size 256k"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_connect_timeout "),a("span",{attrs:{class:"token number"}},[t._v("75")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_send_timeout "),a("span",{attrs:{class:"token number"}},[t._v("300")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_read_timeout "),a("span",{attrs:{class:"token number"}},[t._v("300")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_buffer_size 1m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_buffers "),a("span",{attrs:{class:"token number"}},[t._v("8")]),t._v(" 512k"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_busy_buffers_size 2m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_temp_file_write_size 2m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_next_upstream error "),a("span",{attrs:{class:"token builtin"}},[t._v("timeout")]),t._v(" invalid_header http_500 http_502 http_503"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         proxy_max_temp_file_size 128m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"load-balance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#load-balance","aria-hidden":"true"}},[this._v("#")]),this._v(" Load Balance")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"具体配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 具体配置")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[t._v("worker_processes  "),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{attrs:{class:"token number"}},[t._v("1024")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token builtin"}},[t._v("include")]),t._v("       mime"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("types"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    default_type  application"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ssl_session_cache   shared"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("SSL"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_session_timeout 10m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    limit_req_zone $binary_remote_addr zone"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("allips"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10m rate"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("30r"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("m")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_cache_path "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("proxy_cache levels"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" keys_zone"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("content"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("20m inactive"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("1d max_size"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("100m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        "),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    keepalive_timeout  "),a("span",{attrs:{class:"token number"}},[t._v("70")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rewrite ^"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" permanent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cn")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cn")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rewrite ^"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" permanent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        rewrite ^"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ https"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server_name"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" permanent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    # HTTPS server\n    #\n    server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         listen       "),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),t._v(" http2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         listen "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),t._v(" http2 ipv6only"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         server_name  localhost wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("xin wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cn")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("com")]),t._v(" www"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("cn")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n         #limit_conn one "),a("span",{attrs:{class:"token number"}},[t._v("50")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         #limit_rate 500k"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         #limit_req zone"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("allips burst"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("5")]),t._v(" nodelay"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$http_user_agent ~"),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Scrapy|Curl|HttpClient"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$http_user_agent ~ "),a("span",{attrs:{class:"token string"}},[t._v('"WinHttp|WebZIP|FetchURL|node-superagent|java/|FeedDemon|Jullo|JikeSpider|Indy Library|Alexa Toolbar|AskTbFXTV|AhrefsBot|CrawlDaddy|Java|Feedly|Apache-HttpAsyncClient|UniversalFeedParser|ApacheBench|Microsoft URL Control|Swiftbot|ZmEu|oBot|jaunty|Python-urllib|lightDeckReports Bot|YYSpider|DigExt|HttpClient|MJ12bot|heritrix|EasouSpider|Ezooms|BOT/0.1|YandexBot|FlightDeckReports|Linguee Bot|^$"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request_method "),a("span",{attrs:{class:"token operator"}},[t._v("!~")]),t._v(" ^"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GET|HEAD|POST"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("403")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n         add_header Strict"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Transport"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Security "),a("span",{attrs:{class:"token string"}},[t._v('"max-age=31536000; includeSubDomains;preload"')]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Frame"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Options DENY"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Options nosniff"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         add_header "),a("span",{attrs:{class:"token keyword"}},[t._v("X")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Xss"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Protection "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n         ssl_certificate   "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("crt"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_certificate_key  "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("wyydsb"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token builtin"}},[t._v("key")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_session_timeout 5m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_prefer_server_ciphers "),a("span",{attrs:{class:"token keyword"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_dhparam "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token builtin"}},[t._v("ssl")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("certs"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("dhparam"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("pem"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_protocols TLSv1 TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" TLSv1"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_ciphers "),a("span",{attrs:{class:"token string"}},[t._v('"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_buffer_size "),a("span",{attrs:{class:"token number"}},[t._v("1400")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_session_cache builtin"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("1000")]),t._v(" shared"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("SSL"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10m"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ssl_ecdh_curve secp384r1"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n         location "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             root   "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n             index  index"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("html index"),a("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("htm"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考")])}],!1,null,null,null);o.options.__file="nginx.md";s.default=o.exports}}]);