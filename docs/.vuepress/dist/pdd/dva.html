<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dva | ä¹Œäº‘å‹é¡¶æ˜¯å§</title>
    <meta name="description" content="ãŠ—ï¸æŸäººç”Ÿæ—¥å¿«ä¹ğŸ‰">
    
    
    <link rel="preload" href="/assets/css/0.styles.6acf8380.css" as="style"><link rel="preload" href="/assets/js/app.02cca196.js" as="script"><link rel="preload" href="/assets/js/7.0005dfa0.js" as="script"><link rel="prefetch" href="/assets/js/10.7ad27450.js"><link rel="prefetch" href="/assets/js/2.285762ea.js"><link rel="prefetch" href="/assets/js/3.ad3b6e7c.js"><link rel="prefetch" href="/assets/js/4.0f9f1586.js"><link rel="prefetch" href="/assets/js/5.5e526c6a.js"><link rel="prefetch" href="/assets/js/6.d8844d1c.js"><link rel="prefetch" href="/assets/js/8.62c9f7e5.js"><link rel="prefetch" href="/assets/js/9.e81b42cd.js"><link rel="prefetch" href="/assets/js/11.c37c162c.js"><link rel="prefetch" href="/assets/js/12.db5c7c0b.js"><link rel="prefetch" href="/assets/js/13.8b613be9.js"><link rel="prefetch" href="/assets/js/14.8fa9218f.js"><link rel="prefetch" href="/assets/js/15.a162fd7c.js"><link rel="prefetch" href="/assets/js/16.00f5c57b.js"><link rel="prefetch" href="/assets/js/17.90d4a479.js"><link rel="prefetch" href="/assets/js/18.af519db8.js"><link rel="prefetch" href="/assets/js/19.355ef318.js"><link rel="prefetch" href="/assets/js/20.171a4f1a.js"><link rel="prefetch" href="/assets/js/21.77afc3d0.js"><link rel="prefetch" href="/assets/js/22.e3dbb09b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6acf8380.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ä¹Œäº‘å‹é¡¶æ˜¯å§</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/react/componentdidupdate.html" class="nav-link">React</a></div><div class="nav-item"><a href="/summary/cs.html" class="nav-link">Summary</a></div><div class="nav-item"><a href="/pdd/" class="nav-link router-link-active">Pdd</a></div> <a href="https://github.com/iofu728/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/react/componentdidupdate.html" class="nav-link">React</a></div><div class="nav-item"><a href="/summary/cs.html" class="nav-link">Summary</a></div><div class="nav-item"><a href="/pdd/" class="nav-link router-link-active">Pdd</a></div> <a href="https://github.com/iofu728/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>æŒ‡å—</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/pdd/" class="sidebar-link">ä»‹ç»</a></li><li><a href="/pdd/structure.html" class="sidebar-link">ç›®å½•çº¦å®š</a></li><li><a href="/pdd/router.html" class="sidebar-link">è·¯ç”±</a></li><li><a href="/pdd/dva.html" class="active sidebar-link">Dva</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pdd/dva.html#ä»€ä¹ˆæ˜¯-dva" class="sidebar-link">ä»€ä¹ˆæ˜¯ Dva</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#models" class="sidebar-link">Models</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#å–æ•°æ®-mapstatetoprops" class="sidebar-link">å–æ•°æ® mapStateToProps</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#router" class="sidebar-link">Router</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#æ•°æ®æµå‘" class="sidebar-link">æ•°æ®æµå‘</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#ä¸umiç»“åˆä½¿ç”¨" class="sidebar-link">ä¸umiç»“åˆä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/pdd/dva.html#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li><li><a href="/pdd/promise.html" class="sidebar-link">å‡½æ•°å¼ç¼–ç¨‹</a></li><li><a href="/pdd/fetch.html" class="sidebar-link">Fetch</a></li><li><a href="/pdd/deploy.html" class="sidebar-link">éƒ¨ç½²</a></li><li><a href="/pdd/style.html" class="sidebar-link">Style</a></li><li><a href="/pdd/mock.html" class="sidebar-link">Mock æ•°æ®</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>å‚è€ƒ</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/pdd/faq.html" class="sidebar-link">FAQ</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="dva"><a href="#dva" aria-hidden="true" class="header-anchor">#</a> Dva</h1> <h2 id="ä»€ä¹ˆæ˜¯-dva"><a href="#ä»€ä¹ˆæ˜¯-dva" aria-hidden="true" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ Dva</h2> <p>é¦–å…ˆ Dva æ˜¯ React æ¡†æ¶ ä¸‹ ä¸€ç§æ•°æ®<code>ç»´æŠ¤</code>/<code>å¤„ç†</code>/<code>æµ</code> æ–¹æ¡ˆ</p> <h3 id="ä¸€-react-è¡¨ç¤ºæ³•"><a href="#ä¸€-react-è¡¨ç¤ºæ³•" aria-hidden="true" class="header-anchor">#</a> ä¸€: React è¡¨ç¤ºæ³•</h3> <p><img src="https://cdn.yuque.com/yuque/0/2018/png/103904/1528436560812-2586a0b5-7a6a-4a07-895c-f822fa85d5de.png" alt="å›¾ç‰‡.png | left | 747x518"></p> <p>å‚ç…§ React å®˜æ–¹æ–‡æ¡£, å¦‚æœå¤šä¸ª Component ä¹‹é—´è¦å‘ç”Ÿäº¤äº’, é‚£ä¹ˆçŠ¶æ€(å³: æ•°æ®)å°±ä¿å­˜åœ¨åœ¨è¿™äº› Component çš„æœ€å°å…¬çº¦çˆ¶èŠ‚ç‚¹ä¸Š, å³ <code>&lt;App/&gt;</code></p> <p><code>&lt;TodoList/&gt; &lt;Todo/&gt;</code> ä»¥åŠ<code>&lt;AddTodoBtn/&gt;</code> æœ¬èº«ä¸ç»´æŒä»»ä½• state, å®Œå…¨ç”±çˆ¶èŠ‚ç‚¹<code>&lt;App/&gt;</code> ä¼ å…¥ props ä»¥å†³å®šå…¶å±•ç°, æ˜¯ä¸€ä¸ªçº¯å‡½æ•°çš„å­˜åœ¨å½¢å¼, å³: <code>Pure Component</code></p> <h3 id="äºŒ-redux-è¡¨ç¤ºæ³•"><a href="#äºŒ-redux-è¡¨ç¤ºæ³•" aria-hidden="true" class="header-anchor">#</a> äºŒ: Redux è¡¨ç¤ºæ³•</h3> <p><img src="https://cdn.yuque.com/yuque/0/2018/png/103904/1528436134375-4c15f63d-72f1-4c73-94a6-55b220d2547c.png" alt="å›¾ç‰‡.png | left | 747x558"></p> <p>Redux åšäº†ä»¥ä¸‹æ”¹è¿›ï¼š</p> <ol><li>å°†æ•°æ®çŠ¶æ€åŠé¡µé¢é€»è¾‘ä» <code>&lt;App/&gt;</code>é‡Œé¢æŠ½å–å‡ºæ¥, å˜æˆ store-æ•°æ®, reducer-é¡µé¢é€»è¾‘</li> <li><code>&lt;TodoList/&gt;</code> åŠ<code>&lt;AddTodoBtn/&gt;</code>éƒ½æ˜¯ Pure Component, é€šè¿‡ connect æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»™å®ƒä¿©åŠ ä¸€å±‚ wrapper ä»è€Œå»ºç«‹èµ·ä¸ store çš„è”ç³»: å¯ä»¥é€šè¿‡ dispatch å‘ store æ³¨å…¥ action, ä¿ƒä½¿ store çš„çŠ¶æ€è¿›è¡Œå˜åŒ–, åŒæ—¶åˆè®¢é˜…äº† store çš„çŠ¶æ€å˜åŒ–, ä¸€æ—¦çŠ¶æ€æœ‰å˜, è¢« connect çš„ç»„ä»¶ä¹Ÿéšä¹‹åˆ·æ–°</li> <li>ä½¿ç”¨ dispatch å¾€ store å‘é€ action çš„è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥è¢«æ‹¦æˆªçš„, è‡ªç„¶è€Œç„¶åœ°å°±å¯ä»¥åœ¨è¿™é‡Œå¢åŠ å„ç§ Middleware, å®ç°å„ç§è‡ªå®šä¹‰åŠŸèƒ½, eg: logging</li></ol> <p>è¿™æ ·ä¸€æ¥, å„ä¸ªéƒ¨åˆ†å„å¸å…¶èŒ, è€¦åˆåº¦æ›´ä½, å¤ç”¨åº¦æ›´é«˜, æ‰©å±•æ€§æ›´å¥½</p> <h3 id="ä¸‰-åŠ å…¥-saga"><a href="#ä¸‰-åŠ å…¥-saga" aria-hidden="true" class="header-anchor">#</a> ä¸‰: åŠ å…¥ Saga</h3> <p><img src="https://cdn.yuque.com/yuque/0/2018/png/103904/1528436167824-7fa834ea-aa6c-4f9f-bab5-b8c5312bcf7e.png" alt="å›¾ç‰‡.png | left | 747x504"></p> <p><code>redux-saga</code> æ˜¯ä¸€ç§ é€šè¿‡æ‹¦æˆªactionï¼Œå®ç°å¼‚æ­¥æ“ä½œçš„Middleware</p> <ol><li>saga æ‹¦æˆªæŸä¸ª å¼‚æ­¥action A, å°†actionæ”¹ä¸º A_REQUESTï¼Œå¹¶å‘èµ· http è¯·æ±‚ï¼›</li> <li>å¦‚æœè¯·æ±‚æˆåŠŸ, åˆ™ç»§ç»­å‘ reducer å‘ä¸€ä¸ª type == A_SUCCESS çš„ action, æç¤ºåˆ›å»ºæˆåŠŸ, åä¹‹åˆ™å‘é€ type == A_FAILURE çš„ action</li> <li>saga é’ˆå¯¹å¼‚æ­¥ è¯·æ±‚ è‡ªèº«ç‰¹ç‚¹ ç»™å‡ºäº† ä¸€äº› å¼‚æ­¥å¤„ç†çš„APIï¼Œ å¦‚<code>take</code>ï¼Œ <code>call</code>ï¼Œ <code>put</code>ï¼Œ<code>all</code>ï¼›è¿˜æœ‰ä¸€äº›é«˜é˜¶APIï¼Œ å¦‚<code>takeLeast</code>ï¼Œ <code>takeLeading</code>ï¼Œ<code>throttle</code>ã€‚è¿™äº›API å¯¹äºå¤„ç†å¼‚æ­¥æ•°æ®æµ æ˜¯ååˆ†æ–¹ä¾¿çš„ã€‚</li></ol> <h3 id="å››-dva-è¡¨ç¤ºæ³•"><a href="#å››-dva-è¡¨ç¤ºæ³•" aria-hidden="true" class="header-anchor">#</a> å››: Dva è¡¨ç¤ºæ³•</h3> <p><img src="https://cdn.yuque.com/yuque/0/2018/png/103904/1528436195004-cd3800f2-f13d-40ba-bb1f-4efba99cfe0d.png" alt="å›¾ç‰‡.png | left | 747x490"></p> <p>Dva å°±åšäº†ä¸€ä»¶äº‹ï¼š æŠŠredux å’Œ redux-saga å°è£…åœ¨ä¸€èµ·ï¼Œ ç®€åŒ–äº†åŸæœ¬è¾ƒä¸ºç¹å†—çš„ä»£ç </p> <ol><li>æŠŠ store åŠ saga ç»Ÿä¸€ä¸ºä¸€ä¸ª model çš„æ¦‚å¿µ, å†™åœ¨ä¸€ä¸ª js æ–‡ä»¶é‡Œé¢</li> <li>å¢åŠ äº†ä¸€ä¸ª Subscriptions, ç”¨äºæ”¶é›†å…¶ä»–æ¥æºçš„ action, eg: é”®ç›˜æ“ä½œï¼Œè¿›å…¥é¡µé¢ï¼ˆå¯ä»£æ›¿reactçš„ <code>componentDidMount</code>ï¼‰</li> <li>model å†™æ³•å¾ˆç®€çº¦</li></ol> <h2 id="models"><a href="#models" aria-hidden="true" class="header-anchor">#</a> Models</h2> <h3 id="state"><a href="#state" aria-hidden="true" class="header-anchor">#</a> State</h3> <p><code>type State = any</code></p> <p>State è¡¨ç¤º å­˜åœ¨<code>Store</code>ä¸­çš„æ•°æ®ï¼Œé€šå¸¸è¡¨ç°ä¸ºä¸€ä¸ª <code>javascript</code> å¯¹è±¡ï¼›ï¸ï¸æ“ä½œçš„æ—¶å€™æ¯æ¬¡éƒ½è¦å½“ä½œä¸å¯å˜æ•°æ®ï¼ˆimmutable dataï¼‰æ¥å¯¹å¾…ï¼Œç‰¹åˆ«æ˜¯jsä¸­çš„åŸç”ŸMapï¼Œä¿è¯æ¯æ¬¡éƒ½æ˜¯å…¨æ–°å¯¹è±¡ï¼Œæ²¡æœ‰å¼•ç”¨å…³ç³»ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ State çš„ç‹¬ç«‹æ€§ï¼Œä¾¿äºæµ‹è¯•å’Œè¿½è¸ªå˜åŒ–ã€‚</p> <p>å¯é€šè¿‡ dva çš„å®ä¾‹å±æ€§ <code>_store</code> çœ‹åˆ°é¡¶éƒ¨çš„ state æ•°æ®ï¼Œä½†æ˜¯é€šå¸¸ä½ å¾ˆå°‘ä¼šç”¨åˆ°:</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>_store<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é¡¶éƒ¨çš„ state æ•°æ®</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="action"><a href="#action" aria-hidden="true" class="header-anchor">#</a> Action</h3> <p><code>type Action = any</code></p> <p>Action æ˜¯ä¸€ä¸ªæ™®é€š <code>javascript</code> å¯¹è±¡ï¼Œå®ƒæ˜¯æ”¹å˜ <code>State</code> çš„å”¯ä¸€é€”å¾„ã€‚æ— è®ºæ˜¯ä» UI äº‹ä»¶ã€ç½‘ç»œå›è°ƒï¼Œè¿˜æ˜¯ WebSocket ç­‰æ•°æ®æºæ‰€è·å¾—çš„æ•°æ®ï¼Œæœ€ç»ˆéƒ½ä¼šé€šè¿‡ dispatch/put å‡½æ•°è°ƒç”¨ä¸€ä¸ª actionï¼Œä»è€Œæ”¹å˜å¯¹åº”çš„æ•°æ®ã€‚</p> <p>action å¿…é¡»å¸¦æœ‰ <code>type</code> å±æ€§æŒ‡æ˜å…·ä½“çš„è¡Œä¸ºï¼Œå…¶å®ƒå­—æ®µå¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè¦å‘èµ·ä¸€ä¸ª action éœ€è¦ä½¿ç”¨ <code>dispatch</code> å‡½æ•°ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ <code>dispatch</code> æ˜¯åœ¨ç»„ä»¶ connect Modelsä»¥åï¼Œé€šè¿‡ props ä¼ å…¥çš„ã€‚</p> <p>åœ¨Dvaä¸­ï¼Œactionå¯ä»¥ä½œç”¨äº <code>effect</code> å’Œ <code>reducer</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dispatch({
  type: 'fetchTaskList',
  filter: {
    offset: 0,
    limit: 20,
  }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="dispatch-å‡½æ•°"><a href="#dispatch-å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> dispatch å‡½æ•°</h3> <p><code>type dispatch = (a: Action) =&gt; Action</code></p> <p>dispatch function æ˜¯ä¸€ä¸ªç”¨äºè§¦å‘ action çš„å‡½æ•°ï¼Œaction æ˜¯æ”¹å˜ State çš„å”¯ä¸€é€”å¾„ï¼Œä½†æ˜¯å®ƒåªæè¿°äº†ä¸€ä¸ªè¡Œä¸ºï¼Œè€Œ dipatch å¯ä»¥çœ‹ä½œæ˜¯è§¦å‘è¿™ä¸ªè¡Œä¸ºçš„æ–¹å¼ï¼Œè€Œ Reducer åˆ™æ˜¯æè¿°å¦‚ä½•æ”¹å˜æ•°æ®çš„ã€‚</p> <p>åœ¨ dva ä¸­ï¼Œconnect Model çš„ç»„ä»¶é€šè¿‡ props å¯ä»¥è®¿é—®åˆ° dispatchï¼Œå¯ä»¥è°ƒç”¨ Model ä¸­çš„ Reducer æˆ–è€… Effectsï¼Œå¸¸è§çš„å½¢å¼å¦‚ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'user/add'</span><span class="token punctuation">,</span> <span class="token comment">// å¦‚æœåœ¨ model å¤–è°ƒç”¨ï¼Œéœ€è¦æ·»åŠ  namespace</span>
  xxx<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// éœ€è¦ä¼ é€’çš„ä¿¡æ¯</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="reducer"><a href="#reducer" aria-hidden="true" class="header-anchor">#</a> Reducer</h3> <p><code>type Reducer&lt;S, A&gt; = (state: S, action: A) =&gt; S</code></p> <p>Reducerï¼ˆä¹Ÿç§°ä¸º reducing functionï¼‰å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¹‹å‰å·²ç»ç´¯ç§¯è¿ç®—çš„ç»“æœå’Œå½“å‰è¦è¢«ç´¯ç§¯çš„å€¼ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ç´¯ç§¯ç»“æœã€‚è¯¥å‡½æ•°æŠŠä¸€ä¸ªé›†åˆå½’å¹¶æˆä¸€ä¸ªå•å€¼ã€‚</p> <p>Reducer çš„æ¦‚å¿µæ¥è‡ªäºæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰ reduce APIã€‚å¦‚åœ¨ javascript ä¸­ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prev <span class="token operator">+</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//expect return 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åœ¨ dva ä¸­ï¼Œreducers åšçš„å°±æ˜¯ æ‹¿åˆ°æ–°æ—§æ•°æ®ï¼Œå¹¶è¿”å›å°†è¦æ›´æ–°çš„ç»“æœã€‚</p> <p>ä¸€èˆ¬ï¼Œreduceråªç”¨æ¥åšæ•°æ®æ›´æ–°çš„å·¥ä½œï¼Œä¸åšä»»ä½•å…¶ä»–ä½œç”¨ã€‚ï¼ˆæ•°æ®æ¯”è¾ƒè¿™äº›éƒ½æ”¾åœ¨effecä¸­è¿›è¡Œï¼Œreducerä¸æ”¾ä»»ä½•å’Œä¸šåŠ¡é€»è¾‘æœ‰å…³çš„ä¸œè¥¿ï¼Œç›¸å½“äºreduxä¸­åŒæ­¥è°ƒç”¨ï¼‰</p> <h3 id="effectğŸˆ"><a href="#effectğŸˆ" aria-hidden="true" class="header-anchor">#</a> <strong>Effect</strong>ğŸˆ</h3> <h4 id="å¾ˆé‡è¦çš„å‡½æ•°"><a href="#å¾ˆé‡è¦çš„å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> å¾ˆé‡è¦çš„å‡½æ•°</h4> <p>Effect å¯ä»¥è¢«ç¿»è¯‘æˆå‰¯ä½œç”¨ï¼Œæœ€å¸¸è§çš„ç”¨å¤„å°±æ˜¯å®ç°å¼‚æ­¥æ“ä½œã€‚å®ƒæ¥è‡ªäºå‡½æ•°ç¼–ç¨‹çš„æ¦‚å¿µï¼Œä¹‹æ‰€ä»¥å«å‰¯ä½œç”¨æ˜¯å› ä¸ºå®ƒä½¿å¾—æˆ‘ä»¬çš„å‡½æ•°å˜å¾—ä¸çº¯ï¼ŒåŒæ ·çš„è¾“å…¥ä¸ä¸€å®šè·å¾—åŒæ ·çš„è¾“å‡ºã€‚</p> <p>dva ä¸ºäº†æ§åˆ¶å‰¯ä½œç”¨çš„æ“ä½œï¼Œåº•å±‚å¼•å…¥äº†<a href="http://superraytin.github.io/redux-saga-in-chinese" target="_blank" rel="noopener noreferrer">redux-sagas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>åšå¼‚æ­¥æµç¨‹æ§åˆ¶ã€‚é‡‡ç”¨äº†<a href="http://www.ruanyifeng.com/blog/2015/04/generator.html" target="_blank" rel="noopener noreferrer">generatorçš„ç›¸å…³æ¦‚å¿µ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œæ‰€ä»¥å°†å¼‚æ­¥è½¬æˆåŒæ­¥å†™æ³•ï¼Œä»è€Œå°†effectsè½¬ä¸ºçº¯å‡½æ•°ã€‚é€šè¿‡yieldå®ç°å¼‚æ­¥ç­‰å¾…ï¼Œä»è€Œå®Œæˆå¼‚æ­¥çš„åŠŸèƒ½ã€‚</p> <p>åœ¨æˆ‘çœ‹æ¥ï¼Œ reduceræ˜¯ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œæœ‰å…³æ•°æ®çš„ä¸šåŠ¡é€»è¾‘ä¸€èˆ¬æ”¾åœ¨è¿™é‡Œï¼Œä½¿å¾—æ•°æ®åœ¨è¿›å…¥DOMä¹‹åä¸ä¼šæœ‰è¿‡å¤šçš„å¤„ç†å·¥ä½œï¼Œå°½é‡æŠŠReactå†™æˆ<code>Pure PureComponent</code>ã€‚</p> <p>åƒTaishanä¸­æ•°æ®å¤„ç†æœ€å¤æ‚çš„Taskæ¨¡å—ï¼Œæ‰€æœ‰å¤„ç†å·¥ä½œéƒ½æ”¾åœ¨<code>/models/task.js</code>çš„effectä¸­ï¼Œå¤æ‚çš„å‡½æ•°é•¿è¾¾æ•°ç™¾è¡Œã€‚</p> <h4 id="saga-ä½é˜¶api"><a href="#saga-ä½é˜¶api" aria-hidden="true" class="header-anchor">#</a> saga ä½é˜¶Api</h4> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">*</span> <span class="token function">fetchTaskDetail</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> taskId <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> select<span class="token punctuation">,</span> all <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> layout<span class="token punctuation">:</span> <span class="token punctuation">{</span> intervals <span class="token punctuation">}</span><span class="token punctuation">,</span> task<span class="token punctuation">:</span> <span class="token punctuation">{</span> report<span class="token punctuation">:</span> <span class="token punctuation">{</span> taskDetail<span class="token punctuation">:</span> taskDetailAgo<span class="token punctuation">,</span> taskInfo <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span>state <span class="token operator">=&gt;</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>intervals<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> taskDetail <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>taskServices<span class="token punctuation">.</span>fetchTaskDetail<span class="token punctuation">,</span> taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>taskDetail<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">compareObject</span><span class="token punctuation">(</span>taskDetail<span class="token punctuation">)</span><span class="token punctuation">(</span>taskDetailAgo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'saveTaskDetail'</span><span class="token punctuation">,</span> taskDetail <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>taskInfo<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'prepareTaskReport'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å½“action ä¸­çš„ type åŒ¹é…åˆ°'fetchTaskDetail', åˆ™ä¼šè°ƒç”¨ä¸Šè¿°Generate *å‡½æ•°ã€‚</p> <p>è¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯dispatchä¼ è¿›æ¥çš„Objectï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥è·å–éœ€è¦çš„å‚æ•°å€¼ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯redux-saga Apiåç§°ï¼Œä»…æ”¯æŒä½é˜¶APiï¼ˆé«˜é˜¶åˆ©ç”¨å¦å¤–æ–¹æ³•æ‰ç”¨ï¼‰ã€‚</p> <p>å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°ç”¨åˆ°äº†å››ä¸ªsagaçš„<code>APi</code>ï¼Œ<code>call``put``select``all</code><br>
åˆ†åˆ«å®ç°</p> <p><code>select</code>-ä»storeè·å–stateå€¼,<br> <code>call</code>  -è°ƒç”¨servicesé‡Œé¢çš„requestï¼Œå¹¶ä¼ å…¥å‚æ•°ï¼Œ<br> <code>put</code>   -ç›¸å½“äºmodelå¤–çš„dispatchï¼Œå‘é€actionè¯·æ±‚ï¼Œåœ¨è¿™é‡Œä¸»è¦ç”¨äºè°ƒç”¨ä¸‹æ¸¸å‡½æ•°/å­˜å‚¨å‡½æ•°reducer<br> <code>all</code>   -ä½¿å¾—allæ•°ç»„ä¸­çš„è¯·æ±‚ åŒæ­¥è¿›è¡Œ å‡å°å¼‚æ­¥ç­‰å¾… é€ æˆçš„æ—¶é—´æŸè€—ï¼Œ<br>
è¿˜å¯èƒ½ä½¿ç”¨<br> <code>take</code>  -ç­‰å¾…å‡½æ•°ï¼Œç”¨äºå®ç°è¿›åº¦åŒæ­¥,</p> <p>è¯¥å‡½æ•°åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p> <ol><li>selectå‡ºintervalsï¼Œå¦‚æœintervalsä¸ºfalseï¼Œå‡½æ•°ç»ˆæ­¢ï¼Œé¡ºä¾¿selectå‡ºstoreä¸­å­˜å‚¨çš„æ—§çš„æ•°æ®ï¼›</li> <li>è°ƒç”¨servicesè¯·æ±‚ï¼Œå¹¶å µå¡ç›´åˆ°æ”¶åˆ°Http Responseï¼›</li> <li>å¦‚æœè¶…æ—¶ æˆ–è€… æŠ¥é”™ï¼Œåˆ™æ‹¿åˆ°çš„resultä¸ºç©ºï¼Œæ­¤æ—¶ï¼Œä¸å­˜å…¥storeï¼Œå‡½æ•°ç»ˆæ­¢ï¼›</li> <li>æ¯”è¾ƒæ‹¿åˆ°çš„resultå€¼ï¼Œå¦‚æœæ›´æ–°äº†å°±è°ƒç”¨reducerï¼›</li> <li>å¦‚æœtaskInfoä¸ä¸ºç©ºåˆ™ï¼Œè¿è¡Œprepareå‡½æ•°ï¼Œprepareå‡½æ•°æ˜¯ä½äºeffectä¸­çš„æ•°æ®å¤„ç†å‡½æ•°ï¼›</li></ol> <h4 id="saga-é«˜é˜¶api"><a href="#saga-é«˜é˜¶api" aria-hidden="true" class="header-anchor">#</a> Saga é«˜é˜¶Api</h4> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>    fetchTaskFlowDetail<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">fetchTaskFlowDetailFunc</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> taskFlowId <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> select<span class="token punctuation">,</span> all <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> task<span class="token punctuation">:</span> <span class="token punctuation">{</span> taskFlow<span class="token punctuation">:</span> <span class="token punctuation">{</span> taskFlowDetail<span class="token punctuation">:</span> taskFlowDetailAgo<span class="token punctuation">,</span> taskFlowAllReport <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> layout<span class="token punctuation">:</span> <span class="token punctuation">{</span> intervals <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span>state <span class="token operator">=&gt;</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>intervals <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>taskFlowDetailAgo<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> taskFlowDetail <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>taskServices<span class="token punctuation">.</span>fetchTaskFlowDetail<span class="token punctuation">,</span> taskFlowId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>taskFlowDetail<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> taskFlowDetail<span class="token punctuation">;</span>
        taskFlowDetail<span class="token punctuation">.</span>completed <span class="token operator">=</span> status <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token string">'200700'</span> <span class="token operator">||</span> status <span class="token operator">===</span> <span class="token string">'200800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">compareObject</span><span class="token punctuation">(</span>taskFlowDetail<span class="token punctuation">)</span><span class="token punctuation">(</span>taskFlowDetailAgo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'saveTaskFlowDetail'</span><span class="token punctuation">,</span> taskFlowDetail <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'prepareTaskFlowDetail'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span>taskFlowDetail<span class="token punctuation">.</span>completed <span class="token operator">&amp;&amp;</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'prepareTaskFlowRealMetric'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token function">Boolean</span><span class="token punctuation">(</span>taskFlowDetail<span class="token punctuation">.</span>completed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>taskFlowAllReport<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>allReport<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetchTaskFlowAllReport'</span><span class="token punctuation">,</span> taskFlowId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>taskFlowDetailAgo<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'prepareTaskFlowList'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'takeLatest'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>å’Œä¸Šé¢çš„effect ç•¥æœ‰ä¸åŒï¼Œå½“ä½¿ç”¨é«˜é˜¶APiæ—¶å€™ï¼Œæ˜¯åœ¨æ•°ç»„çš„ç¬¬äºŒé¡¹ä¸­è°ƒç”¨ã€‚ç„¶åæŠŠåŸæ¥çš„å‡½æ•°æ”¾åœ¨æ•°ç»„çš„ç¬¬ä¸€é¡¹ã€‚<br>
ç›®å‰dva èµ„ç“· <code>takeEvery</code>,<code>takeLeast</code>,<code>throttle</code> è¯¦è§-&gt;<a href="https://github.com/dvajs/dva/blob/master/packages/dva-core/src/getSaga.js" target="_blank" rel="noopener noreferrer">dvaæºç <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>å…¶å® ç‰¹åˆ« æœŸå¾… æ”¯æŒ <code>takeLeading</code>çš„ è™½ç„¶ å¯ä»¥é€šè¿‡ä½é˜¶Api ç»„åˆä½¿ç”¨ ä½† ç›®å‰ æµ‹è¯•take æœªèµ·ä½œç”¨ã€‚// todo</p> <h3 id="subscription"><a href="#subscription" aria-hidden="true" class="header-anchor">#</a> Subscription</h3> <p>Subscriptions æ˜¯ä¸€ç§ä» <strong>æº</strong> è·å–æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒæ¥è‡ªäº elmã€‚</p> <p>Subscription è¯­ä¹‰æ˜¯è®¢é˜…ï¼Œç”¨äºè®¢é˜…ä¸€ä¸ªå¤–éƒ¨äº‹ä»¶ï¼Œç„¶åæ ¹æ®æ¡ä»¶ dispatch éœ€è¦çš„ actionã€‚å¤–éƒ¨å¯ä»¥æ˜¯å½“å‰çš„æ—¶é—´ã€æœåŠ¡å™¨çš„ websocket è¿æ¥ã€keyboard è¾“å…¥ã€history è·¯ç”±å˜åŒ–ç­‰ç­‰ã€‚</p> <p>ç›®å‰TAISHANé¡¹ç›®ä¸­ ä¸»è¦åˆ©ç”¨å…¶ ä»£æ›¿Reactçš„<code>componentDidMount</code>ï¼Œç›‘å¬è·¯ç”±å˜åŒ–ï¼Œä»è€Œå¼€å§‹/ç»“æŸè°ƒç”¨å¼‚æ­¥è¯·æ±‚ã€‚</p> <p>æ­¤å¤–è¿˜åˆ©ç”¨è¿›è¡Œäº›è®¸é”®ç›˜å¿«æ·é”®å®šåˆ¶ã€‚</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>  subscriptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pathname <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        nowPath <span class="token operator">=</span> pathname <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">?</span> <span class="token string">'/task'</span> <span class="token punctuation">:</span> pathname<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>baseUrl<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'com'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>importScriptTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetchHashList'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'application/javascript'</span><span class="token punctuation">;</span>
          script<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://cavalry.corp.yiran.com/sdk/js/v1.js'</span><span class="token punctuation">;</span>
          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetchUser'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetchTime'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'group/fetchGroupList'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'flow/fetchDefaultScript'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeInterval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetchTime'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> intervalTime <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'timeAdd'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> intervalTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="å–æ•°æ®-mapstatetoprops"><a href="#å–æ•°æ®-mapstatetoprops" aria-hidden="true" class="header-anchor">#</a> å–æ•°æ® mapStateToProps</h2> <p>å’Œreduxä¸€è‡´ åˆ©ç”¨connectæŠŠæ•°æ®å’Œcomponentç»‘å®šåœ¨ä¸€èµ·</p> <p>åˆ©ç”¨mapStateToProps, æŠŠredux stateä¸­çš„æ•°æ®æ”¾åˆ°propsä¸­</p> <p>æ­¤å æ¯æ¬¡è¯¥componentç»‘å®šçš„æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œè¯¥æ–¹æ³•å°†ä¼šè¢«å†æ¬¡è°ƒç”¨</p> <p>éšä¹‹ ä¸€ç³»åˆ—ç”Ÿå‘½å‘¨æœŸ ä¼šè¢«ä¾æ¬¡è°ƒç”¨</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">mapStateToProps</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">:</span> <span class="token punctuation">{</span> effects <span class="token punctuation">}</span><span class="token punctuation">,</span> layout<span class="token punctuation">:</span> <span class="token punctuation">{</span> isAdmin<span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token punctuation">{</span> userList<span class="token punctuation">,</span> grantList <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> routing<span class="token punctuation">:</span> <span class="token punctuation">{</span> location<span class="token punctuation">:</span> <span class="token punctuation">{</span> pathname <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    isAdmin<span class="token punctuation">,</span> userList<span class="token punctuation">,</span> grantList<span class="token punctuation">,</span>
    grantLoad<span class="token punctuation">:</span> effects<span class="token punctuation">[</span><span class="token string">'layout/fetchGrantList'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    groupId<span class="token punctuation">:</span> path<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="router"><a href="#router" aria-hidden="true" class="header-anchor">#</a> Router</h2> <p>è¯¥éƒ¨åˆ†ç”±umiè‡ªåŠ¨ç”Ÿæˆ</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Router<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva/router'</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Router</span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>HomePage<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Router</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="æ•°æ®æµå‘"><a href="#æ•°æ®æµå‘" aria-hidden="true" class="header-anchor">#</a> æ•°æ®æµå‘</h2> <p>æ•°æ®çš„æ”¹å˜å‘ç”Ÿé€šå¸¸æ˜¯é€šè¿‡ç”¨æˆ·äº¤äº’è¡Œä¸ºæˆ–è€…æµè§ˆå™¨è¡Œä¸ºï¼ˆå¦‚è·¯ç”±è·³è½¬ç­‰ï¼‰è§¦å‘çš„ï¼Œå½“æ­¤ç±»è¡Œä¸ºä¼šæ”¹å˜æ•°æ®çš„æ—¶å€™å¯ä»¥é€šè¿‡ <code>dispatch</code> å‘èµ·ä¸€ä¸ª actionï¼Œå¦‚æœæ˜¯åŒæ­¥è¡Œä¸ºä¼šç›´æ¥é€šè¿‡ <code>Reducers</code> æ”¹å˜ <code>State</code> ï¼Œå¦‚æœæ˜¯å¼‚æ­¥è¡Œä¸ºï¼ˆå‰¯ä½œç”¨ï¼‰ä¼šå…ˆè§¦å‘ <code>Effects</code> ç„¶åæµå‘ <code>Reducers</code> æœ€ç»ˆæ”¹å˜ <code>State</code>ï¼Œæ‰€ä»¥åœ¨ dva ä¸­ï¼Œæ•°æ®æµå‘éå¸¸æ¸…æ™°ç®€æ˜ï¼Œå¹¶ä¸”æ€è·¯åŸºæœ¬è·Ÿå¼€æºç¤¾åŒºä¿æŒä¸€è‡´ï¼ˆä¹Ÿæ˜¯æ¥è‡ªäºå¼€æºç¤¾åŒºï¼‰ã€‚</p> <img src="https://zos.alipayobjects.com/rmsportal/PPrerEAKbIoDZYr.png" width="807"> <h2 id="ä¸umiç»“åˆä½¿ç”¨"><a href="#ä¸umiç»“åˆä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> ä¸umiç»“åˆä½¿ç”¨</h2> <ul><li><strong>æŒ‰ç›®å½•çº¦å®šæ³¨å†Œ model</strong>ï¼Œæ— éœ€æ‰‹åŠ¨ <code>app.model</code></li> <li><strong>æ–‡ä»¶åå³ namespace</strong>ï¼Œå¯ä»¥çœå» model å¯¼å‡ºçš„ <code>namespace</code> key</li> <li><strong>æ— éœ€æ‰‹å†™ router.js</strong>ï¼Œäº¤ç»™ umi å¤„ç†ï¼Œæ”¯æŒ model å’Œ component çš„æŒ‰éœ€åŠ è½½</li> <li><strong>å†…ç½® query-string å¤„ç†</strong>ï¼Œæ— éœ€å†æ‰‹åŠ¨è§£ç å’Œç¼–ç </li> <li><strong>å†…ç½® dva-loading å’Œ dva-immer</strong>ï¼Œå…¶ä¸­ dva-immer éœ€é€šè¿‡é…ç½®å¼€å¯</li> <li><strong>å¼€ç®±å³ç”¨</strong>ï¼Œæ— éœ€å®‰è£…é¢å¤–ä¾èµ–ï¼Œæ¯”å¦‚ dvaã€dva-loadingã€dva-immerã€path-to-regexpã€object-assignã€reactã€react-dom ç­‰</li></ul> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒ</h2> <ul><li><a href="https://github.com/sorrycc/blog/issues/66" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ umi æ”¹è¿› dva é¡¹ç›®å¼€å‘<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/sorrycc/blog/issues/62" target="_blank" rel="noopener noreferrer">umi + dvaï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„ CURD åº”ç”¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://dvajs.com/guide/concepts.html" target="_blank" rel="noopener noreferrer">dvaæ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/25/2018, 11:24:32 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pdd/router.html" class="prev">
          è·¯ç”±
        </a></span> <span class="next"><a href="/pdd/promise.html">
          å‡½æ•°å¼ç¼–ç¨‹
        </a>
        â†’
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/7.0005dfa0.js" defer></script><script src="/assets/js/app.02cca196.js" defer></script>
  </body>
</html>
